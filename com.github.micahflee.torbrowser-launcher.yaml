app-id: com.github.micahflee.torbrowser-launcher
runtime: org.kde.Platform
runtime-version: '5.15-21.08'
sdk: org.kde.Sdk
separate-locales: false
command: torbrowser-launcher
rename-desktop-file: torbrowser.desktop
rename-appdata-file: torbrowser.appdata.xml
rename-icon: torbrowser
finish-args:
  - --share=ipc
  - --share=network
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri
  - --socket=pulseaudio
  - --filesystem=xdg-download
  - --env=MOZ_ENABLE_WAYLAND=1
modules:
  - shared-modules/dbus-glib/dbus-glib-0.110.json

  - name: python3-pyqt
    buildsystem: simple
    build-commands:
      - "pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} PyQt5"
    cleanup:
      - /bin
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/ea/a3/3d3cbbb7150f90c4cf554048e1dceb7c6ab330e4b9138a40e130a4cc79e1/setuptools-62.1.0.tar.gz
        sha256: 47c7b0c0f8fc10eec4cf1e71c6fdadf8decaa74ffa087e68cd1c20db7ad6a592
        x-checker-data:
          type: pypi
          name: setuptools
      - type: file
        url: https://files.pythonhosted.org/packages/c0/6c/9f840c2e55b67b90745af06a540964b73589256cb10cc10057c87ac78fc2/wheel-0.37.1.tar.gz
        sha256: e9a504e793efbca1b8e0e9cb979a249cf4a0a7b5b8c9e8b65a5e39d49529c1c4
        x-checker-data:
          type: pypi
          name: wheel
      - type: file
        url: https://files.pythonhosted.org/packages/8b/5f/1bd49787262ddce37b826ef49dcccf5a9970facf0ed363dee5ee233e681d/PyQt-builder-1.12.2.tar.gz
        sha256: f62bb688d70e0afd88c413a8d994bda824e6cebd12b612902d1945c5a67edcd7
        x-checker-data:
          type: pypi
          name: PyQt-builder
      - type: file
        url: https://files.pythonhosted.org/packages/df/9e/d1a7217f69310c1db8fdf8ab396229f55a699ce34a203691794c5d1cad0c/packaging-21.3.tar.gz
        sha256: dd47c42927d89ab911e606518907cc2d3a1f38bbd026385970643f9c5b8ecfeb
        x-checker-data:
          type: pypi
          name: packaging
      - type: file
        url: https://files.pythonhosted.org/packages/be/ba/1f744cdc819428fc6b5084ec34d9b30660f6f9daaf70eead706e3203ec3c/toml-0.10.2.tar.gz
        sha256: b3bda1d108d5dd99f4a20d24d9c348e91c4db7ab1b749200bded2f839ccbe68f
        x-checker-data:
          type: pypi
          name: toml
      - type: file
        url: https://files.pythonhosted.org/packages/31/df/789bd0556e65cf931a5b87b603fcf02f79ff04d5379f3063588faaf9c1e4/pyparsing-3.0.8.tar.gz
        sha256: 7bf433498c016c4314268d95df76c81b842a4cb2b276fa3312cfb1e1d85f6954
        x-checker-data:
          type: pypi
          name: pyparsing
      - type: file
        url: https://files.pythonhosted.org/packages/71/39/171f1c67cd00715f190ba0b100d606d440a28c93c7714febeca8b79af85e/six-1.16.0.tar.gz
        sha256: 1e61c37477a1626458e36f7b1d82aa5c9b094fa4802892072e49de9c60c4c926
        x-checker-data:
          type: pypi
          name: six
      - type: file
        url: https://files.pythonhosted.org/packages/c6/08/34642c4db19e9d41f43640547c5a997cb9b12b512f8c61d0d476e8b9e883/sip-6.6.1.tar.gz
        sha256: 696c575c72144122701171f2cc767fe6cc87050ea755a04909152a8508ae10c3
        x-checker-data:
          type: pypi
          name: sip
      - type: file
        url: https://files.pythonhosted.org/packages/e5/69/882ee5c9d017149285cab114ebeab373308ef0f874fcdac9beb90e0ac4da/ply-3.11.tar.gz
        sha256: 00c7c1aaa88358b9c765b6d3000c6eec0ba42abca5351b095321aef446081da3
        x-checker-data:
          type: pypi
          name: ply
      - type: file
        url: https://files.pythonhosted.org/packages/15/d1/d8798b83e953fd6f86ca9b50f93eec464a9305b0661469c8234e61095481/flit_core-3.7.1.tar.gz
        sha256: 14955af340c43035dbfa96b5ee47407e377ee337f69e70f73064940d27d0a44f
        x-checker-data:
          type: pypi
          name: flit_core
      - type: file
        url: https://files.pythonhosted.org/packages/a3/82/08a09deda701feb930aa6462f2f22e07cbcb9aa7c1ef361a090221b4587e/PyQt5_sip-12.10.1.tar.gz
        sha256: 97e008795c453488f51a5c97dbff29cda7841afb1ca842c9e819d8e6cc0ae724
        x-checker-data:
          type: pypi
          name: PyQt5_sip
      - type: file
        url: https://files.pythonhosted.org/packages/3b/27/fd81188a35f37be9b3b4c2db1654d9439d1418823916fe702ac3658c9c41/PyQt5-5.15.6.tar.gz
        sha256: 80343bcab95ffba619f2ed2467fd828ffeb0a251ad7225be5fc06dcc333af452
        x-checker-data:
          type: pypi
          name: PyQt5

  - name: SWIG
    config-opts:
      - --without-boost
      - --without-alllang
    cleanup:
      - /bin
      - /share/swig
    sources:
      - type: archive
        url: https://sourceforge.net/projects/swig/files/swig/swig-4.0.2/swig-4.0.2.tar.gz
        sha256: d53be9730d8d58a16bf0cbd1f8ac0c0c3e1090573168bfa151b01eb47fa906fc
        x-checker-data:
          type: anitya
          project-id: 4919
          url-template: https://sourceforge.net/projects/swig/files/swig/swig-$version/swig-$version.tar.gz

  - name: gpgme
    config-opts:
      - --enable-languages=python
    sources:
      - type: archive
        url: https://www.gnupg.org/ftp/gcrypt/gpgme/gpgme-1.17.1.tar.bz2
        sha256: 711eabf5dd661b9b04be9edc9ace2a7bc031f6bd9d37a768d02d0efdef108f5f
        x-checker-data:
          type: anitya
          project-id: 1239
          url-template: https://www.gnupg.org/ftp/gcrypt/gpgme/gpgme-$version.tar.bz2

  - name: python3-requests
    buildsystem: simple
    build-commands:
      - "pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} requests"
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/62/08/e3fc7c8161090f742f504f40b1bccbfc544d4a4e09eb774bf40aafce5436/idna-3.3.tar.gz
        sha256: 9d643ff0a55b762d5cdb124b8eaa99c66322e2157b69160bc32796e824360e6d
        x-checker-data:
          type: pypi
          name: idna
      - type: file
        url: https://files.pythonhosted.org/packages/60/f3/26ff3767f099b73e0efa138a9998da67890793bfa475d8278f84a30fec77/requests-2.27.1.tar.gz
        sha256: 68d7c56fd5a8999887728ef304a6d12edc7be74f1cfa47714fc8b414525c9a61
        x-checker-data:
          type: pypi
          name: requests
      - type: file
        url: https://files.pythonhosted.org/packages/6c/ae/d26450834f0acc9e3d1f74508da6df1551ceab6c2ce0766a593362d6d57f/certifi-2021.10.8.tar.gz
        sha256: 78884e7c1d4b00ce3cea67b44566851c4343c120abd683433ce934a68ea58872
        x-checker-data:
          type: pypi
          name: certifi
      - type: file
        url: https://files.pythonhosted.org/packages/1b/a5/4eab74853625505725cefdf168f48661b2cd04e7843ab836f3f63abf81da/urllib3-1.26.9.tar.gz
        sha256: aabaf16477806a5e1dd19aa41f8c2b7950dd3c746362d7e3223dbe6de6ac448e
        x-checker-data:
          type: pypi
          name: urllib3
      - type: file
        url: https://files.pythonhosted.org/packages/56/31/7bcaf657fafb3c6db8c787a865434290b726653c912085fbd371e9b92e1c/charset-normalizer-2.0.12.tar.gz
        sha256: 2857e29ff0d34db842cd7ca3230549d1a697f96ee6d3fb071cfa6c7393832597
        x-checker-data:
          type: pypi
          name: charset-normalizer
      - type: file
        url: https://files.pythonhosted.org/packages/ee/2d/9cdc2b527e127b4c9db64b86647d567985940ac3698eeabc7ffaccb4ea61/chardet-4.0.0.tar.gz
        sha256: 0d6f53a15db4120f2b08c94f11e7d93d2c911ee118b6b30a04ec3ee8310179fa
        x-checker-data:
          type: pypi
          name: chardet

  - name: python3-socks
    buildsystem: simple
    build-commands:
      - "python3 setup.py install --prefix=${FLATPAK_DEST} --root=/"
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/bd/11/293dd436aea955d45fc4e8a35b6ae7270f5b8e00b53cf6c024c83b657a11/PySocks-1.7.1.tar.gz
        sha256: 3f8804571ebe159c380ac6de37643bb4685970655d3bba243530d6558b799aa0
        x-checker-data:
          type: pypi
          name: PySocks

  - name: python3-packaging
    buildsystem: simple
    build-commands:
      - "pip3 install --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} packaging"
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/d9/5a/e7c31adbe875f2abbb91bd84cf2dc52d792b5a01506781dbcf25c91daf11/six-1.16.0-py2.py3-none-any.whl
        sha256: 8abb2f1d86890a2dfb989f9a77cfcfd3e47c2a354b01111771326f8aa26e0254
        x-checker-data:
          type: pypi
          name: six
          packagetype: bdist_wheel
      - type: file
        url: https://files.pythonhosted.org/packages/05/8e/8de486cbd03baba4deef4142bd643a3e7bbe954a784dc1bb17142572d127/packaging-21.3-py3-none-any.whl
        sha256: ef103e05f519cdc783ae24ea4e2e0f508a9c99b2d4969652eed6a2e1ea5bd522
        x-checker-data:
          type: pypi
          name: packaging
          packagetype: bdist_wheel
      - type: file
        url: https://files.pythonhosted.org/packages/d9/41/d9cfb4410589805cd787f8a82cddd13142d9bf7449d12adf2d05a4a7d633/pyparsing-3.0.8-py3-none-any.whl
        sha256: ef7b523f6356f763771559412c0d7134753f037822dad1b16945b7b846f7ad06
        x-checker-data:
          type: pypi
          name: pyparsing
          packagetype: bdist_wheel

  - name: python3-distro
    buildsystem: simple
    build-commands:
      - "pip3 install --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} distro"
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/e1/54/d08d1ad53788515392bec14d2d6e8c410bffdc127780a9a4aa8e6854d502/distro-1.7.0-py3-none-any.whl
        sha256: d596311d707e692c2160c37807f83e3820c5d539d5a83e87cfb6babd8ba3a06b
        x-checker-data:
          type: pypi
          name: distro
          packagetype: bdist_wheel

  - name: torbrowser-launcher
    buildsystem: simple
    sources:
      - type: archive
        url: https://github.com/micahflee/torbrowser-launcher/archive/refs/tags/v0.3.5.tar.gz
        sha256: 623cd77c6095711f371fee5b5cc521ecd8dd89d964b75fad6449633d10925089
        x-checker-data:
          type: anitya
          project-id: 6359
          url-template: https://github.com/micahflee/torbrowser-launcher/archive/refs/tags/v$version.tar.gz
      - type: patch
        path: use-flatpak-sys-prefix.patch
    build-commands:
      - "python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1"
    post-install:
      - "sed -i 's:Icon=torbrowser:Icon=com.github.micahflee.torbrowser-launcher:' /app/share/applications/torbrowser-settings.desktop"
      - "mv /app/share/applications/torbrowser-settings.desktop /app/share/applications/com.github.micahflee.torbrowser-launcher.settings.desktop"
