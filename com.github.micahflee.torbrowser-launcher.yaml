app-id: com.github.micahflee.torbrowser-launcher
runtime: org.kde.Platform
runtime-version: 5.15-21.08
sdk: org.kde.Sdk
base: com.riverbankcomputing.PyQt.BaseApp
base-version: 5.15-21.08
cleanup-commands:
  - /app/cleanup-BaseApp.sh
build-options:
  env:
    - BASEAPP_REMOVE_WEBENGINE=1
separate-locales: false
command: torbrowser-launcher
rename-desktop-file: torbrowser.desktop
rename-appdata-file: torbrowser.appdata.xml
rename-icon: torbrowser
finish-args:
  - --share=ipc
  - --share=network
  - --socket=wayland
  - --socket=fallback-x11
  - --talk-name=org.freedesktop.Notifications
  - --device=dri
  - --socket=pulseaudio
  - --filesystem=xdg-download
  - --env=MOZ_ENABLE_WAYLAND=1
modules:
  - shared-modules/dbus-glib/dbus-glib-0.110.json

  - name: PyQtApp

  - name: SWIG
    config-opts:
      - --without-boost
      - --without-alllang
    cleanup:
      - /bin
      - /share/swig
    sources:
      - type: archive
        url: https://sourceforge.net/projects/swig/files/swig/swig-4.0.2/swig-4.0.2.tar.gz
        sha256: d53be9730d8d58a16bf0cbd1f8ac0c0c3e1090573168bfa151b01eb47fa906fc
        x-checker-data:
          type: anitya
          project-id: 4919
          url-template: https://sourceforge.net/projects/swig/files/swig/swig-$version/swig-$version.tar.gz

  - name: gpgme
    config-opts:
      - --enable-languages=python
    sources:
      - type: archive
        url: https://www.gnupg.org/ftp/gcrypt/gpgme/gpgme-1.17.1.tar.bz2
        sha256: 711eabf5dd661b9b04be9edc9ace2a7bc031f6bd9d37a768d02d0efdef108f5f
        x-checker-data:
          type: anitya
          project-id: 1239
          url-template: https://www.gnupg.org/ftp/gcrypt/gpgme/gpgme-$version.tar.bz2

  - name: python3-requests
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        requests
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/c5/41/247814d8b7a044717164c74080725a6c8f3d2b5fc82b34bd825b617df663/setuptools-65.5.0.tar.gz
        sha256: 512e5536220e38146176efb833d4a62aa726b7bbff82cfbc8ba9eaa3996e0b17
        x-checker-data:
          type: pypi
          name: setuptools
      - type: file
        url: https://files.pythonhosted.org/packages/46/57/f39f082f448205ec06a771fe30eec77ed650c0c8e3f7d7f193e12efb4fd4/wheel-0.38.0.tar.gz
        sha256: d52844afee64cdd4bb28061ba6b5c06818b237fb490263e0dbea227080f7d2d7
        x-checker-data:
          type: pypi
          name: wheel
      - type: file
        url: https://files.pythonhosted.org/packages/15/d1/d8798b83e953fd6f86ca9b50f93eec464a9305b0661469c8234e61095481/flit_core-3.7.1.tar.gz
        sha256: 14955af340c43035dbfa96b5ee47407e377ee337f69e70f73064940d27d0a44f
        x-checker-data:
          type: pypi
          name: flit_core
      - type: file
        url: https://files.pythonhosted.org/packages/8b/e1/43beb3d38dba6cb420cefa297822eac205a277ab43e5ba5d5c46faf96438/idna-3.4.tar.gz
        sha256: 814f528e8dead7d329833b91c5faa87d60bf71824cd12a7530b5526063d02cb4
        x-checker-data:
          type: pypi
          name: idna
      - type: file
        url: https://files.pythonhosted.org/packages/a5/61/a867851fd5ab77277495a8709ddda0861b28163c4613b011bc00228cc724/requests-2.28.1.tar.gz
        sha256: 7c5599b102feddaa661c826c56ab4fee28bfd17f5abca1ebbe3e7f19d7c97983
        x-checker-data:
          type: pypi
          name: requests
      - type: file
        url: https://files.pythonhosted.org/packages/cb/a4/7de7cd59e429bd0ee6521ba58a75adaec136d32f91a761b28a11d8088d44/certifi-2022.9.24.tar.gz
        sha256: 0d9c601124e5a6ba9712dbc60d9c53c21e34f5f641fe83002317394311bdce14
        x-checker-data:
          type: pypi
          name: certifi
      - type: file
        url: https://files.pythonhosted.org/packages/b2/56/d87d6d3c4121c0bcec116919350ca05dc3afd2eeb7dc88d07e8083f8ea94/urllib3-1.26.12.tar.gz
        sha256: 3fa96cf423e6987997fc326ae8df396db2a8b7c667747d47ddd8ecba91f4a74e
        x-checker-data:
          type: pypi
          name: urllib3
      - type: file
        url: https://files.pythonhosted.org/packages/fe/77/6d5d367b7cfee812a88573e80bbe25cea2d015ed2c3490e4464951ff3232/charset-normalizer-3.0.0.tar.gz
        sha256: b27d10ad15740b45fd55f76e6901a4391e6dca3917ef48ecdcf17edf6e00d770
        x-checker-data:
          type: pypi
          name: charset-normalizer
      - type: file
        url: https://files.pythonhosted.org/packages/31/a2/12c090713b3d0e141f367236d3a8bdc3e5fca0d83ff3647af4892c16c205/chardet-5.0.0.tar.gz
        sha256: 0368df2bfd78b5fc20572bb4e9bb7fb53e2c094f60ae9993339e8671d0afb8aa
        x-checker-data:
          type: pypi
          name: chardet

  - name: python3-socks
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/bd/11/293dd436aea955d45fc4e8a35b6ae7270f5b8e00b53cf6c024c83b657a11/PySocks-1.7.1.tar.gz
        sha256: 3f8804571ebe159c380ac6de37643bb4685970655d3bba243530d6558b799aa0
        x-checker-data:
          type: pypi
          name: PySocks

  - name: python3-packaging
    buildsystem: simple
    build-commands:
      - pip3 install --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        packaging
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/d9/5a/e7c31adbe875f2abbb91bd84cf2dc52d792b5a01506781dbcf25c91daf11/six-1.16.0-py2.py3-none-any.whl
        sha256: 8abb2f1d86890a2dfb989f9a77cfcfd3e47c2a354b01111771326f8aa26e0254
        x-checker-data:
          type: pypi
          name: six
          packagetype: bdist_wheel
      - type: file
        url: https://files.pythonhosted.org/packages/05/8e/8de486cbd03baba4deef4142bd643a3e7bbe954a784dc1bb17142572d127/packaging-21.3-py3-none-any.whl
        sha256: ef103e05f519cdc783ae24ea4e2e0f508a9c99b2d4969652eed6a2e1ea5bd522
        x-checker-data:
          type: pypi
          name: packaging
          packagetype: bdist_wheel
      - type: file
        url: https://files.pythonhosted.org/packages/6c/10/a7d0fa5baea8fe7b50f448ab742f26f52b80bfca85ac2be9d35cdd9a3246/pyparsing-3.0.9-py3-none-any.whl
        sha256: 5026bae9a10eeaefb61dab2f09052b9f4307d44aee4eda64b309723d8d206bbc
        x-checker-data:
          type: pypi
          name: pyparsing
          packagetype: bdist_wheel

  - name: python3-distro
    buildsystem: simple
    build-commands:
      - pip3 install --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        distro
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/f4/2c/c90a3adaf0ddb70afe193f5ebfb539612af57cffe677c3126be533df3098/distro-1.8.0-py3-none-any.whl
        sha256: 99522ca3e365cac527b44bde033f64c6945d90eb9f769703caaec52b09bbd3ff
        x-checker-data:
          type: pypi
          name: distro
          packagetype: bdist_wheel

  - name: libnotify
    buildsystem: meson
    config-opts:
      - -Dtests=false
      - -Dintrospection=disabled
      - -Dman=false
      - -Dgtk_doc=false
      - -Ddocbook_docs=disabled
    sources:
      - type: archive
        url: https://download.gnome.org/sources/libnotify/0.8/libnotify-0.8.1.tar.xz
        sha256: d033e6d4d6ccbf46a436c31628a4b661b36dca1f5d4174fe0173e274f4e62557
        x-checker-data:
          type: anitya
          project-id: 13149
          url-template: https://download.gnome.org/sources/libnotify/$major.$minor/libnotify-$version.tar.xz

  - name: torbrowser-launcher
    buildsystem: simple
    sources:
      - type: archive
        url: https://github.com/micahflee/torbrowser-launcher/archive/refs/tags/v0.3.5.tar.gz
        sha256: 623cd77c6095711f371fee5b5cc521ecd8dd89d964b75fad6449633d10925089
        x-checker-data:
          type: anitya
          project-id: 6359
          url-template: https://github.com/micahflee/torbrowser-launcher/archive/refs/tags/v$version.tar.gz
      - type: patch
        path: use-flatpak-sys-prefix.patch
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    post-install:
      - sed -i 's:Icon=torbrowser:Icon=com.github.micahflee.torbrowser-launcher:'
        /app/share/applications/torbrowser-settings.desktop
      - mv /app/share/applications/torbrowser-settings.desktop /app/share/applications/com.github.micahflee.torbrowser-launcher.settings.desktop
